<head>
  <meta http-equiv="refresh" content="1">
</head>

<h1>Last Ynar Record</h1>

<% if @content %>
  <p>Content: <%= @content %></p>
  <p>Created At: <%= @created_at %></p>
<% else %>
  <p>No records found.</p>
<% end %>

<p>
  <small>Connected to Host (Rails Config): <%= ApplicationRecord.connection_pool.db_config.host %></small><br>
  <small>Server IP (from DB): <%= @server_ip %></small><br>
  <small>App IP (Controller): <%= @app_ip %></small><br>
  <small>Current Role: <%= ActiveRecord::Base.current_role %></small><br>
  <small>Current Shard: <%= ActiveRecord::Base.current_shard %></small><br>
  <small>Prevent Writes: <%= ActiveRecord::Base.connected_to?(role: :reading) %></small><br>
  <small>DB Time: <%= @db_time %></small>
</p>

<!-- MONITOR_DATA: <%= @db_statuses.to_json %> -->

<h3>Database Health Monitor (via Redis)</h3>
<table border="1" style="border-collapse: collapse; width: 100%; text-align: left;">
  <thead>
    <tr style="background-color: #f2f2f2;">
      <th>Node</th>
      <th>Role</th>
      <th>Status</th>
      <th>Lag (ms)</th>
      <th>Message</th>
    </tr>
  </thead>
  <tbody>
    <% @db_statuses.each do |role, status| %>
      <tr>
        <td><%= role %></td>
        <td><%= status["role"] %></td>
        <td style="color: <%= status["healthy"] ? 'green' : 'red' %>; font-weight: bold;">
          <%= status["healthy"] ? "HEALTHY" : "UNHEALTHY" %>
        </td>
        <td><%= status["lag_ms"] || 0 %> ms</td>
        <td><%= status["message"] %></td>
      </tr>
    <% end %>
  </tbody>
</table>
